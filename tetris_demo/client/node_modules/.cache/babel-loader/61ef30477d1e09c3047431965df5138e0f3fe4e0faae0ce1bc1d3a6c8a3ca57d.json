{"ast":null,"code":"var _jsxFileName = \"/Users/josephop/distributed-systems/tetris_demo/client/src/BoardStage.jsx\",\n  _s = $RefreshSig$();\n// client/src/BoardStage.jsx\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Stage, Layer, Group, Rect } from 'react-konva';\n\n/* ===== tweakable constants ======================================= */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CELL = 30;\nconst PARTICLES_PER_BLOCK = 75; // explosion density\nconst LOCK_EFFECT = 'tint'; // 'tint' (brighten) or 'mute' (darken)\nconst LOCK_FLASH_MS = 120; // ms duration of lock flash\nconst CLEAR_STYLE = 'explode'; // current clear-animation style\n/* ================================================================= */\n\n/* canonical NES/TGM colors */\nconst BASE = {\n  1: '#00FFFF',\n  2: '#0000FF',\n  3: '#FF7700',\n  4: '#FFFF00',\n  5: '#00FF00',\n  6: '#FF0000',\n  7: '#AA00FF'\n};\n\n/* color helpers */\nconst toRgb = h => [0, 2, 4].map(i => parseInt(h.slice(1 + i, 3 + i), 16));\nconst toHex = rgb => '#' + rgb.map(v => Math.max(0, Math.min(255, Math.round(v))).toString(16).padStart(2, '0')).join('');\nconst mix = (h, tgt, t) => toHex(toRgb(h).map((v, i) => v + (tgt[i] - v) * t));\nconst LIGHT = h => mix(h, [255, 255, 255], 0.5);\n_c = LIGHT;\nconst MID = h => mix(h, [255, 255, 255], 0.25);\n_c2 = MID;\nconst DARK = h => mix(h, [0, 0, 0], 0.5);\n_c3 = DARK;\nconst TINT = h => mix(h, [255, 255, 255], 0.6);\n_c4 = TINT;\nconst MUTE = h => mix(h, [0, 0, 0], 0.6);\n\n// ──────────────────────────────────────────────────────────────────\n_c5 = MUTE;\nexport default function BoardStage({\n  board = [],\n  players = {},\n  linesToClear = []\n}) {\n  _s();\n  var _board$;\n  const rows = board.length;\n  const cols = ((_board$ = board[0]) === null || _board$ === void 0 ? void 0 : _board$.length) || 0;\n  const W = cols * CELL;\n  const H = rows * CELL;\n\n  /* ─── preload sounds ─────────────────────────────────────────── */\n  const lockSfx = useRef(new Audio(`${process.env.PUBLIC_URL}/sounds/lock_sound.wav`));\n  const clearSfx = useRef(new Audio(`${process.env.PUBLIC_URL}/sounds/clear.mp3`));\n  useEffect(() => {\n    [lockSfx, clearSfx].forEach(ref => {\n      ref.current.preload = 'auto';\n      ref.current.load();\n    });\n  }, []);\n\n  /* ─── lock-flash canvas overlay ──────────────────────────────── */\n  const flashCanvasRef = useRef(null);\n  const [lockFlashes, setLockFlashes] = useState([]);\n\n  /* flag that stays TRUE for the entire line-clear sequence       */\n  const clearingInProgressRef = useRef(false);\n  useEffect(() => {\n    var _flashCanvasRef$curre;\n    /* ── skip logic: ignore diff while rows are clearing/shifted ─ */\n    const skipThisFrame = clearingInProgressRef.current;\n\n    // if rows are flagged, the 30-frame countdown is active\n    if (linesToClear.length > 0) {\n      clearingInProgressRef.current = true;\n    }\n    // rows list empty again → board has shifted this frame\n    else if (clearingInProgressRef.current && linesToClear.length === 0) {\n      // keep skip true for this frame, but clear for next frame\n      clearingInProgressRef.current = false;\n    }\n    if (skipThisFrame) {\n      // resync snapshot and bail\n      if (flashCanvasRef.current) {\n        flashCanvasRef.current.__prevBoard = board.map(r => [...r]);\n      }\n      return;\n    }\n\n    /* ── normal diff → produce flashes where new blocks appeared ─ */\n    const prev = ((_flashCanvasRef$curre = flashCanvasRef.current) === null || _flashCanvasRef$curre === void 0 ? void 0 : _flashCanvasRef$curre.__prevBoard) || [];\n    const fresh = [];\n    for (let r = 0; r < rows; r++) {\n      for (let c = 0; c < cols; c++) {\n        var _prev$r, _board$r;\n        if (!((_prev$r = prev[r]) !== null && _prev$r !== void 0 && _prev$r[c]) && (_board$r = board[r]) !== null && _board$r !== void 0 && _board$r[c]) {\n          const base = BASE[board[r][c].value] || '#888';\n          const color = LOCK_EFFECT === 'tint' ? TINT(base) : MUTE(base);\n          fresh.push({\n            id: `${c}-${r}-${Date.now()}`,\n            x: c,\n            y: r,\n            color,\n            ts: Date.now()\n          });\n        }\n      }\n    }\n    if (fresh.length) {\n      lockSfx.current.currentTime = 0;\n      lockSfx.current.play().catch(() => {});\n      fresh.forEach(f => {\n        setLockFlashes(fs => [...fs, f]);\n        setTimeout(() => {\n          setLockFlashes(fs => fs.filter(x => x.id !== f.id));\n        }, LOCK_FLASH_MS);\n      });\n    }\n    flashCanvasRef.current.__prevBoard = board.map(row => [...row]);\n  }, [board, rows, cols, linesToClear]);\n\n  /* ─── lock-flash draw loop ───────────────────────────────────── */\n  useEffect(() => {\n    const canvas = flashCanvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    let raf;\n    const draw = () => {\n      ctx.clearRect(0, 0, W, H);\n      const now = Date.now();\n      lockFlashes.forEach(f => {\n        const age = now - f.ts;\n        if (age < LOCK_FLASH_MS) {\n          const alphaHex = Math.floor((1 - age / LOCK_FLASH_MS) * 255).toString(16).padStart(2, '0');\n          ctx.fillStyle = f.color + alphaHex;\n          ctx.fillRect(f.x * CELL, f.y * CELL, CELL, CELL);\n        }\n      });\n      raf = requestAnimationFrame(draw);\n    };\n    raf = requestAnimationFrame(draw);\n    return () => cancelAnimationFrame(raf);\n  }, [W, H, lockFlashes]);\n\n  /* ─── explosion on line-clear ────────────────────────────────── */\n  const [particles, setParticles] = useState([]);\n  const clearHandled = useRef(false);\n  useEffect(() => {\n    if (!linesToClear.length) {\n      clearHandled.current = false;\n      return;\n    }\n    if (clearHandled.current) return;\n    clearHandled.current = true;\n    clearSfx.current.currentTime = 0;\n    clearSfx.current.play().catch(() => {});\n\n    // mark that a clear is active so lock-flash will skip\n    clearingInProgressRef.current = true;\n    const rowsSet = new Set(linesToClear);\n    const newParts = [];\n    board.forEach((row, r) => {\n      row.forEach((cell, c) => {\n        if (!cell || !rowsSet.has(r)) return;\n        const base = BASE[cell.value] || '#888';\n        for (let i = 0; i < PARTICLES_PER_BLOCK; i++) {\n          const ang = Math.random() * 2 * Math.PI;\n          const spd = 2 + Math.random() * 2;\n          newParts.push({\n            id: `p-${r}-${c}-${i}-${Date.now()}`,\n            x: c * CELL + Math.random() * CELL,\n            y: r * CELL + Math.random() * CELL,\n            w: 2,\n            h: 2,\n            color: base,\n            dx: Math.cos(ang) * spd,\n            dy: Math.sin(ang) * spd - 0.3,\n            life: 40\n          });\n        }\n      });\n    });\n    setParticles(ps => [...ps, ...newParts]);\n  }, [linesToClear, board]);\n\n  /* ─── particle update loop ───────────────────────────────────── */\n  useEffect(() => {\n    if (!particles.length) return;\n    let raf;\n    const step = () => {\n      setParticles(ps => ps.flatMap(p => {\n        const nx = p.x + p.dx,\n          ny = p.y + p.dy + 0.35,\n          nl = p.life - 1;\n        return nl > 0 ? [{\n          ...p,\n          x: nx,\n          y: ny,\n          life: nl\n        }] : [];\n      }));\n      raf = requestAnimationFrame(step);\n    };\n    raf = requestAnimationFrame(step);\n    return () => cancelAnimationFrame(raf);\n  }, [particles.length]);\n\n  /* ─── memoised locked & active cell lists ────────────────────── */\n  const locked = useMemo(() => board.flatMap((row, r) => {\n    if (CLEAR_STYLE === 'explode' && linesToClear.includes(r)) return [];\n    return row.map((cell, c) => {\n      if (!cell) return null;\n      return {\n        id: `l-${r}-${c}`,\n        x: c,\n        y: r,\n        color: BASE[cell.value] || '#888'\n      };\n    }).filter(Boolean);\n  }), [board, linesToClear]);\n  const active = useMemo(() => Object.values(players).flatMap(p => {\n    var _p$currentPiece;\n    if (p !== null && p !== void 0 && p.isWaitingForNextPiece) return [];\n    const shp = p === null || p === void 0 ? void 0 : (_p$currentPiece = p.currentPiece) === null || _p$currentPiece === void 0 ? void 0 : _p$currentPiece.shape;\n    if (!shp) return [];\n    return shp.flatMap((row, dr) => row.map((v, dc) => {\n      if (!v) return null;\n      const gx = p.x + dc,\n        gy = p.y + dr;\n      if (gx < 0 || gx >= cols || gy < 0 || gy >= rows || CLEAR_STYLE === 'explode' && linesToClear.includes(gy)) return null;\n      if (board[gy] && board[gy][gx] !== 0) return null; // already locked\n      return {\n        id: `a-${gx}-${gy}`,\n        x: gx,\n        y: gy,\n        color: BASE[v] || '#888'\n      };\n    }).filter(Boolean));\n  }), [players, cols, rows, linesToClear]);\n\n  /* ─── glossy Block component ─────────────────────────────────── */\n  const Block = ({\n    x,\n    y,\n    color\n  }) => /*#__PURE__*/_jsxDEV(Group, {\n    x: x * CELL,\n    y: y * CELL,\n    listening: false,\n    children: [/*#__PURE__*/_jsxDEV(Rect, {\n      width: CELL,\n      height: CELL,\n      fill: \"transparent\",\n      stroke: \"#666\",\n      strokeWidth: 1.2,\n      cornerRadius: 3\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Rect, {\n      x: 1,\n      y: 1,\n      width: CELL - 2,\n      height: CELL - 2,\n      cornerRadius: 2.5,\n      fillLinearGradientStartPoint: {\n        x: 0,\n        y: 0\n      },\n      fillLinearGradientEndPoint: {\n        x: 0,\n        y: CELL\n      },\n      fillLinearGradientColorStops: [0, LIGHT(color), 0.45, MID(color), 1, DARK(color)]\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Rect, {\n      x: CELL * 0.15,\n      y: CELL * 0.05,\n      width: CELL * 0.7,\n      height: CELL * 0.25,\n      cornerRadius: CELL * 0.35,\n      fillRadialGradientStartPoint: {\n        x: CELL * 0.35,\n        y: CELL * 0.2\n      },\n      fillRadialGradientEndPoint: {\n        x: CELL * 0.35,\n        y: CELL * 0.2\n      },\n      fillRadialGradientStartRadius: 1,\n      fillRadialGradientEndRadius: CELL * 0.35,\n      fillRadialGradientColorStops: [0, 'rgba(255,255,255,0.85)', 1, 'rgba(255,255,255,0)']\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 240,\n    columnNumber: 5\n  }, this);\n\n  /* ─── render ─────────────────────────────────────────────────── */\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative',\n      width: W,\n      height: H\n    },\n    children: [/*#__PURE__*/_jsxDEV(Stage, {\n      width: W,\n      height: H,\n      children: /*#__PURE__*/_jsxDEV(Layer, {\n        listening: false,\n        children: [/*#__PURE__*/_jsxDEV(Rect, {\n          x: 0,\n          y: 0,\n          width: W,\n          height: H,\n          fill: \"#111\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Group, {\n          opacity: 0.12,\n          children: [Array(rows + 1).fill().map((_, i) => /*#__PURE__*/_jsxDEV(Rect, {\n            x: 0,\n            y: i * CELL,\n            width: W,\n            height: 1,\n            fill: \"#888\"\n          }, `h${i}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 30\n          }, this)), Array(cols + 1).fill().map((_, i) => /*#__PURE__*/_jsxDEV(Rect, {\n            x: i * CELL,\n            y: 0,\n            width: 1,\n            height: H,\n            fill: \"#888\"\n          }, `v${i}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 30\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this), locked.map(b => /*#__PURE__*/_jsxDEV(Block, {\n          ...b\n        }, b.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 28\n        }, this)), active.map(b => /*#__PURE__*/_jsxDEV(Block, {\n          ...b\n        }, b.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 28\n        }, this)), particles.map(p => /*#__PURE__*/_jsxDEV(Rect, {\n          x: p.x,\n          y: p.y,\n          width: p.w,\n          height: p.h,\n          fill: p.color,\n          opacity: p.life / 40,\n          listening: false\n        }, p.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: flashCanvasRef,\n      width: W,\n      height: H,\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        pointerEvents: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 269,\n    columnNumber: 5\n  }, this);\n}\n_s(BoardStage, \"x+MChKb8cPyWO85IE2RJxNT3+Q0=\");\n_c6 = BoardStage;\nvar _c, _c2, _c3, _c4, _c5, _c6;\n$RefreshReg$(_c, \"LIGHT\");\n$RefreshReg$(_c2, \"MID\");\n$RefreshReg$(_c3, \"DARK\");\n$RefreshReg$(_c4, \"TINT\");\n$RefreshReg$(_c5, \"MUTE\");\n$RefreshReg$(_c6, \"BoardStage\");","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","Stage","Layer","Group","Rect","jsxDEV","_jsxDEV","CELL","PARTICLES_PER_BLOCK","LOCK_EFFECT","LOCK_FLASH_MS","CLEAR_STYLE","BASE","toRgb","h","map","i","parseInt","slice","toHex","rgb","v","Math","max","min","round","toString","padStart","join","mix","tgt","t","LIGHT","_c","MID","_c2","DARK","_c3","TINT","_c4","MUTE","_c5","BoardStage","board","players","linesToClear","_s","_board$","rows","length","cols","W","H","lockSfx","Audio","process","env","PUBLIC_URL","clearSfx","forEach","ref","current","preload","load","flashCanvasRef","lockFlashes","setLockFlashes","clearingInProgressRef","_flashCanvasRef$curre","skipThisFrame","__prevBoard","r","prev","fresh","c","_prev$r","_board$r","base","value","color","push","id","Date","now","x","y","ts","currentTime","play","catch","f","fs","setTimeout","filter","row","canvas","ctx","getContext","raf","draw","clearRect","age","alphaHex","floor","fillStyle","fillRect","requestAnimationFrame","cancelAnimationFrame","particles","setParticles","clearHandled","rowsSet","Set","newParts","cell","has","ang","random","PI","spd","w","dx","cos","dy","sin","life","ps","step","flatMap","p","nx","ny","nl","locked","includes","Boolean","active","Object","values","_p$currentPiece","isWaitingForNextPiece","shp","currentPiece","shape","dr","dc","gx","gy","Block","listening","children","width","height","fill","stroke","strokeWidth","cornerRadius","fileName","_jsxFileName","lineNumber","columnNumber","fillLinearGradientStartPoint","fillLinearGradientEndPoint","fillLinearGradientColorStops","fillRadialGradientStartPoint","fillRadialGradientEndPoint","fillRadialGradientStartRadius","fillRadialGradientEndRadius","fillRadialGradientColorStops","style","position","opacity","Array","_","b","top","left","pointerEvents","_c6","$RefreshReg$"],"sources":["/Users/josephop/distributed-systems/tetris_demo/client/src/BoardStage.jsx"],"sourcesContent":["// client/src/BoardStage.jsx\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Stage, Layer, Group, Rect } from 'react-konva';\n\n/* ===== tweakable constants ======================================= */\nconst CELL                = 30;\nconst PARTICLES_PER_BLOCK = 75;   // explosion density\nconst LOCK_EFFECT         = 'tint';   // 'tint' (brighten) or 'mute' (darken)\nconst LOCK_FLASH_MS       = 120;   // ms duration of lock flash\nconst CLEAR_STYLE         = 'explode'; // current clear-animation style\n/* ================================================================= */\n\n/* canonical NES/TGM colors */\nconst BASE = {\n  1: '#00FFFF', 2: '#0000FF', 3: '#FF7700',\n  4: '#FFFF00', 5: '#00FF00', 6: '#FF0000', 7: '#AA00FF'\n};\n\n/* color helpers */\nconst toRgb = h => [0, 2, 4].map(i => parseInt(h.slice(1 + i, 3 + i), 16));\nconst toHex = rgb =>\n  '#' +\n  rgb\n    .map(v => Math.max(0, Math.min(255, Math.round(v))).toString(16).padStart(2, '0'))\n    .join('');\nconst mix   = (h, tgt, t) => toHex(toRgb(h).map((v, i) => v + (tgt[i] - v) * t));\nconst LIGHT = h => mix(h, [255, 255, 255], 0.5);\nconst MID   = h => mix(h, [255, 255, 255], 0.25);\nconst DARK  = h => mix(h, [0, 0, 0],   0.5);\nconst TINT  = h => mix(h, [255, 255, 255], 0.6);\nconst MUTE  = h => mix(h, [0, 0, 0],   0.6);\n\n// ──────────────────────────────────────────────────────────────────\nexport default function BoardStage({ board = [], players = {}, linesToClear = [] }) {\n  const rows = board.length;\n  const cols = board[0]?.length || 0;\n  const W    = cols * CELL;\n  const H    = rows * CELL;\n\n  /* ─── preload sounds ─────────────────────────────────────────── */\n  const lockSfx  = useRef(new Audio(`${process.env.PUBLIC_URL}/sounds/lock_sound.wav`));\n  const clearSfx = useRef(new Audio(`${process.env.PUBLIC_URL}/sounds/clear.mp3`));\n  useEffect(() => {\n    [lockSfx, clearSfx].forEach(ref => {\n      ref.current.preload = 'auto';\n      ref.current.load();\n    });\n  }, []);\n\n  /* ─── lock-flash canvas overlay ──────────────────────────────── */\n  const flashCanvasRef = useRef(null);\n  const [lockFlashes, setLockFlashes] = useState([]);\n\n  /* flag that stays TRUE for the entire line-clear sequence       */\n  const clearingInProgressRef = useRef(false);\n\n  useEffect(() => {\n    /* ── skip logic: ignore diff while rows are clearing/shifted ─ */\n    const skipThisFrame = clearingInProgressRef.current;\n\n    // if rows are flagged, the 30-frame countdown is active\n    if (linesToClear.length > 0) {\n      clearingInProgressRef.current = true;\n    }\n    // rows list empty again → board has shifted this frame\n    else if (clearingInProgressRef.current && linesToClear.length === 0) {\n      // keep skip true for this frame, but clear for next frame\n      clearingInProgressRef.current = false;\n    }\n\n    if (skipThisFrame) {\n      // resync snapshot and bail\n      if (flashCanvasRef.current) {\n        flashCanvasRef.current.__prevBoard = board.map(r => [...r]);\n      }\n      return;\n    }\n\n    /* ── normal diff → produce flashes where new blocks appeared ─ */\n    const prev  = flashCanvasRef.current?.__prevBoard || [];\n    const fresh = [];\n\n    for (let r = 0; r < rows; r++) {\n      for (let c = 0; c < cols; c++) {\n        if (!prev[r]?.[c] && board[r]?.[c]) {\n          const base  = BASE[board[r][c].value] || '#888';\n          const color = LOCK_EFFECT === 'tint' ? TINT(base) : MUTE(base);\n          fresh.push({ id: `${c}-${r}-${Date.now()}`, x: c, y: r, color, ts: Date.now() });\n        }\n      }\n    }\n\n    if (fresh.length) {\n      lockSfx.current.currentTime = 0;\n      lockSfx.current.play().catch(() => {});\n      fresh.forEach(f => {\n        setLockFlashes(fs => [...fs, f]);\n        setTimeout(() => {\n          setLockFlashes(fs => fs.filter(x => x.id !== f.id));\n        }, LOCK_FLASH_MS);\n      });\n    }\n\n    flashCanvasRef.current.__prevBoard = board.map(row => [...row]);\n  }, [board, rows, cols, linesToClear]);\n\n  /* ─── lock-flash draw loop ───────────────────────────────────── */\n  useEffect(() => {\n    const canvas = flashCanvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    let raf;\n    const draw = () => {\n      ctx.clearRect(0, 0, W, H);\n      const now = Date.now();\n      lockFlashes.forEach(f => {\n        const age = now - f.ts;\n        if (age < LOCK_FLASH_MS) {\n          const alphaHex = Math.floor((1 - age / LOCK_FLASH_MS) * 255)\n            .toString(16)\n            .padStart(2, '0');\n          ctx.fillStyle = f.color + alphaHex;\n          ctx.fillRect(f.x * CELL, f.y * CELL, CELL, CELL);\n        }\n      });\n      raf = requestAnimationFrame(draw);\n    };\n    raf = requestAnimationFrame(draw);\n    return () => cancelAnimationFrame(raf);\n  }, [W, H, lockFlashes]);\n\n  /* ─── explosion on line-clear ────────────────────────────────── */\n  const [particles, setParticles] = useState([]);\n  const clearHandled = useRef(false);\n\n  useEffect(() => {\n    if (!linesToClear.length) {\n      clearHandled.current = false;\n      return;\n    }\n    if (clearHandled.current) return;\n    clearHandled.current = true;\n\n    clearSfx.current.currentTime = 0;\n    clearSfx.current.play().catch(() => {});\n\n    // mark that a clear is active so lock-flash will skip\n    clearingInProgressRef.current = true;\n\n    const rowsSet  = new Set(linesToClear);\n    const newParts = [];\n    board.forEach((row, r) => {\n      row.forEach((cell, c) => {\n        if (!cell || !rowsSet.has(r)) return;\n        const base = BASE[cell.value] || '#888';\n        for (let i = 0; i < PARTICLES_PER_BLOCK; i++) {\n          const ang = Math.random() * 2 * Math.PI;\n          const spd = 2 + Math.random() * 2;\n          newParts.push({\n            id:   `p-${r}-${c}-${i}-${Date.now()}`,\n            x:    c * CELL + Math.random() * CELL,\n            y:    r * CELL + Math.random() * CELL,\n            w:    2, h: 2,\n            color: base,\n            dx:   Math.cos(ang) * spd,\n            dy:   Math.sin(ang) * spd - 0.3,\n            life: 40\n          });\n        }\n      });\n    });\n    setParticles(ps => [...ps, ...newParts]);\n  }, [linesToClear, board]);\n\n  /* ─── particle update loop ───────────────────────────────────── */\n  useEffect(() => {\n    if (!particles.length) return;\n    let raf;\n    const step = () => {\n      setParticles(ps =>\n        ps.flatMap(p => {\n          const nx = p.x + p.dx,\n                ny = p.y + p.dy + 0.35,\n                nl = p.life - 1;\n          return nl > 0 ? [{ ...p, x: nx, y: ny, life: nl }] : [];\n        })\n      );\n      raf = requestAnimationFrame(step);\n    };\n    raf = requestAnimationFrame(step);\n    return () => cancelAnimationFrame(raf);\n  }, [particles.length]);\n\n  /* ─── memoised locked & active cell lists ────────────────────── */\n  const locked = useMemo(\n    () =>\n      board.flatMap((row, r) => {\n        if (CLEAR_STYLE === 'explode' && linesToClear.includes(r)) return [];\n        return row\n          .map((cell, c) => {\n            if (!cell) return null;\n            return { id: `l-${r}-${c}`, x: c, y: r, color: BASE[cell.value] || '#888' };\n          })\n          .filter(Boolean);\n      }),\n    [board, linesToClear]\n  );\n\n  const active = useMemo(\n    () =>\n      Object.values(players).flatMap(p => {\n        if (p?.isWaitingForNextPiece) return [];\n        const shp = p?.currentPiece?.shape;\n        if (!shp) return [];\n        return shp.flatMap((row, dr) =>\n          row\n            .map((v, dc) => {\n              if (!v) return null;\n              const gx = p.x + dc,\n                gy = p.y + dr;\n              if (\n                gx < 0 ||\n                gx >= cols ||\n                gy < 0 ||\n                gy >= rows ||\n                (CLEAR_STYLE === 'explode' && linesToClear.includes(gy))\n              )\n                return null;\n              if (board[gy] && board[gy][gx] !== 0) return null; // already locked\n              return { id: `a-${gx}-${gy}`, x: gx, y: gy, color: BASE[v] || '#888' };\n            })\n            .filter(Boolean)\n        );\n      }),\n    [players, cols, rows, linesToClear]\n  );\n\n  /* ─── glossy Block component ─────────────────────────────────── */\n  const Block = ({ x, y, color }) => (\n    <Group x={x * CELL} y={y * CELL} listening={false}>\n      <Rect width={CELL} height={CELL} fill=\"transparent\" stroke=\"#666\" strokeWidth={1.2} cornerRadius={3} />\n      <Rect\n        x={1}\n        y={1}\n        width={CELL - 2}\n        height={CELL - 2}\n        cornerRadius={2.5}\n        fillLinearGradientStartPoint={{ x: 0, y: 0 }}\n        fillLinearGradientEndPoint={{ x: 0, y: CELL }}\n        fillLinearGradientColorStops={[0, LIGHT(color), 0.45, MID(color), 1, DARK(color)]}\n      />\n      <Rect\n        x={CELL * 0.15}\n        y={CELL * 0.05}\n        width={CELL * 0.7}\n        height={CELL * 0.25}\n        cornerRadius={CELL * 0.35}\n        fillRadialGradientStartPoint={{ x: CELL * 0.35, y: CELL * 0.2 }}\n        fillRadialGradientEndPoint={{ x: CELL * 0.35, y: CELL * 0.2 }}\n        fillRadialGradientStartRadius={1}\n        fillRadialGradientEndRadius={CELL * 0.35}\n        fillRadialGradientColorStops={[0, 'rgba(255,255,255,0.85)', 1, 'rgba(255,255,255,0)']}\n      />\n    </Group>\n  );\n\n  /* ─── render ─────────────────────────────────────────────────── */\n  return (\n    <div style={{ position: 'relative', width: W, height: H }}>\n      <Stage width={W} height={H}>\n        <Layer listening={false}>\n          <Rect x={0} y={0} width={W} height={H} fill=\"#111\" />\n          <Group opacity={0.12}>\n            {Array(rows + 1)\n              .fill()\n              .map((_, i) => <Rect key={`h${i}`} x={0} y={i * CELL} width={W} height={1} fill=\"#888\" />)}\n            {Array(cols + 1)\n              .fill()\n              .map((_, i) => <Rect key={`v${i}`} x={i * CELL} y={0} width={1} height={H} fill=\"#888\" />)}\n          </Group>\n          {locked.map(b => <Block key={b.id} {...b} />)}\n          {active.map(b => <Block key={b.id} {...b} />)}\n          {particles.map(p => (\n            <Rect\n              key={p.id}\n              x={p.x}\n              y={p.y}\n              width={p.w}\n              height={p.h}\n              fill={p.color}\n              opacity={p.life / 40}\n              listening={false}\n            />\n          ))}\n        </Layer>\n      </Stage>\n\n      {/* lock-flash overlay */}\n      <canvas\n        ref={flashCanvasRef}\n        width={W}\n        height={H}\n        style={{ position: 'absolute', top: 0, left: 0, pointerEvents: 'none' }}\n      />\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}